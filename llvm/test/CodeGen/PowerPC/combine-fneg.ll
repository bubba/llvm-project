; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=powerpc64le-unknown-unknown | FileCheck %s

; Infinite loop identified in D62963.
define <4 x double> @fneg_fdiv_splat(double %a0, <4 x double> %a1) {
; CHECK-LABEL: fneg_fdiv_splat:
; CHECK:       # %bb.0: # %entry
; CHECK-NEXT:    vspltisw 4, 1
; CHECK-NEXT:    xsredp 0, 1
; CHECK-NEXT:    xvcvsxwdp 2, 36
; CHECK-NEXT:    fmr 3, 2
; CHECK-NEXT:    xsnmsubadp 3, 1, 0
; CHECK-NEXT:    xsmaddadp 0, 0, 3
; CHECK-NEXT:    xsnmsubadp 2, 1, 0
; CHECK-NEXT:    xsnmaddadp 0, 0, 2
; CHECK-NEXT:    xxspltd 0, 0, 0
; CHECK-NEXT:    xvmuldp 34, 34, 0
; CHECK-NEXT:    xvmuldp 35, 35, 0
; CHECK-NEXT:    blr
entry:
  %splat.splatinsert = insertelement <4 x double> undef, double %a0, i32 0
  %splat.splat = shufflevector <4 x double> %splat.splatinsert, <4 x double> undef, <4 x i32> zeroinitializer
  %div = fdiv contract reassoc nsz arcp ninf <4 x double> %a1, %splat.splat
  %sub = fsub contract reassoc nsz <4 x double> <double 0.000000e+00, double 0.000000e+00, double 0.000000e+00, double 0.000000e+00>, %div
  ret <4 x double> %sub
}
